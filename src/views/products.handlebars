<body>
  <header class="container-fluid bg-dark position-sticky top-0">
    <div class="navbar-nav">
      <div class="header2">
        <div class="title">
        <h1>FUNKOPOPS</h1>
        </div>
        <div>
        <a href="/api/carts" class="btn btn-warning cart">ðŸ›’</a>
        </div>
        <div class="saludo">
          <h4 class="card-title pt-2 text-center text-primary">Bienvenido:({{name}})</h4>
        </div>
        <div class="rol">
          <h4 class="card-title pt-2 text-center text-success">Rol:({{rol}})</h4>
        </div>
        <div class="logout">
          <a href="{{baseUrl}}/logout" class="btn btn-danger "><i class="fas fa-sign-out-alt"></i>Salir</a>
        </div>
      </div>
    </div>
  </header>

    <div class="row justify-content-center">
    <h2 class="mt-4 mb-4 d-flex justify-content-center"><b>Listado de productos Total : ({{pagination.totalDocs}})</b></h2>
    </div>



      <div class="row row-cols-sm-10 row-cols-md-2 row-cols-lg-4 row-cols-x1-4" id="card">
        {{#each products}}
        <div class="col d-flex justify-content-center mb-4" id="dataProd">
          <div class="card shadow mb-1 bg-dark rounded" style="width: 20rem">
            <h5 class="card-title pt-2 text-center text-primary">{{this.title}}</h5>
            <img src={{this.thumbnail}} class="card-img-top" />
            <div class="card-body">
              <p class="card-text text-white-50 description">
                {{this.description}}
              </p>
              <h5 class="text-primary">
                Precio: <span>$ {{this.price}}</span>
              </h5>
              <h5 class="text-primary">
                Stock: <span>{{this.stock}}</span>
              </h5>
              <h5 class="text-primary">
                Categoria: <span>{{this.category}}</span>
              </h5>
              <form action="/" method="post">
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary button" onclick="addToCart('{{this.id}}')">
                  AÃ±adir al Carrito
                </button>
              </div>             
              </form>             
            </div>
          </div>
        </div>
        {{/each}}
      </div>



    <div class="d-grid gap-2" id="btn">  
      <div>
                {{#if pagination.hasPrevPage}}
                    <button type="submit" class="btn btn-primary button page-item"><a class="page-link" href="{{pagination.prevPageUrl}}">Anterior</a></button>
                {{else}}
                    <button hidden class="page-item disabled" type="submit"><a class="page-link" href="{{pagination.prevPageUrl}}"></a></button>
                {{/if}}        
                {{#each pagination.pagesArray}}
                    <button class="btn btn-primary button page-item"><a class="page-link" href="{{baseUrl}}?page={{this.index}}">{{this.indexPgBar}}</a></button>
                {{/each}}  
                {{#if pagination.hasNextPage}}
                    <button type="submit" class="btn btn-primary button page-item"><a class="page-link" href="{{pagination.nextPageUrl}}">Siguiente</a></button>
                {{else}}
                    <button hidden class="page-item disabled" type="submit"><a class="page-link" href="{{pagination.nextPageUrl}}"></a></button>
                {{/if}}    
                    <button type="submit" class="btn btn-success button"><a class="page-link" href="/api/products_index">Todos los Productos</a></button>
      </div>    
    </div>



<script>

    const socket = io('ws://localhost:9090');

    socket.on('connect', () => { 
        socket.on('server_confirm', (data) => {
            console.log("El servidor ha confirmado la conexiÃ³n");
           
        });       
      
        socket.on('product_added_to_cart', (data) => {
           console.log('Se disparÃ³ el evento product_added_to_cart con el id', data);
        });
    })

    const addToCart = (product_id) => {  
        console.log(product_id)          
        //socket.emit('new_product_in_cart', product_id);
    }
  
</script>

